"use strict";var Flicker=function(){function e(r,c){return j.paused||c!==j._advanceRef?j:("forward"===j.direction?r>=j.animation.frames.length?(j.paused=!0,j.eventHandlers.flickerEnd.call(j,j.direction)):(s(r),r++):"reverse"===j.direction&&(0>r?(j.paused=!0,j.eventHandlers.flickerEnd.call(j,j.direction)):(s(r),r--)),setTimeout(requestAnimationFrame.bind(null,e.bind(null,r,c)),1e3/30),j)}function s(e){var s=""+j.rootPath+j.animation.frames[e].src,r=document.querySelector('.sprites img[src="'+s+'"]');j.currentSprite!==s&&j.eventHandlers.sequenceChange.call(j,s),j.currentSprite=s,j.currentFrame=e;try{q.drawImage(r,-1*j.animation.frames[e].x,-1*j.animation.frames[e].y)}catch(c){throw new u("CanvasDrawError","Failed to draw image at path '"+s+'\'\r\n. Try adding this within your flicker context:\r\n\r\n<img class="sprite" src="'+s+'" alt=" "/>')}}function r(){var s=arguments.length<=0||void 0===arguments[0]?j.currentFrame:arguments[0],r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],c=new Date;return j._advanceRef=c,j.paused=!1,j.direction=r?"forward":"reverse",e(s,c),j}function c(e){return r(e,!1)}function t(){return j.paused=!0,j}function n(e){return j._delay+=e,{play:function(){return setTimeout(r,1e3*j._delay),j},reverse:function(){return setTimeout(c,1e3*j._delay),j},pause:function(){return setTimeout(t,1e3*j._delay),j},wait:function(){return setTimeout(n,1e3*j._delay),j}}}function p(){return j.paused=!0,s(this.getAttribute("value")),j}function i(e,s){if(e in j.eventHandlers)return j.eventHandlers[e]=s;throw new u("EventHandlerRegistrationError","The specified event '"+e+"' does not exist")}function u(e,s){var r=new Error(s);return r.name=e,r}var g=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],y=function(){if(g.container)return g.container;throw new u("UnspecifiedFlickerContextError","You must specify a container for the Flicker context")}(),a=function(){var e=Array.prototype.slice.call(y.querySelectorAll(".sprite"));if(e.length>0)return e;throw new u("EmptySpriteFlickerError","Each Flicker context must contain at least one sprite")}(),x=y.querySelector("canvas"),q=x.getContext("2d"),_=y.querySelector(".controls input"),o={waitOnImages:function(e){var s=[];s.push=function(){Array.prototype.push.apply(this,arguments),this.length>=a.length&&e.call(j)};for(var r=0;r<a.length;r++)a[r].onload=function c(e){a[e].complete?s.push(a[e]):setTimeout(c.bind(null,e),10)}(r)},throttle:function(e,s,r){s||(s=100);var c,t;return function(){var n=r||this,p=+new Date,i=arguments;c&&c+s>p?(clearTimeout(t),t=setTimeout(function(){c=p,e.apply(n,i)},s)):(c=p,e.apply(n,i))}}},j={animation:function(){if(g.animation)return g.animation;throw new u("AnimationInitialisationError","You must initialise the Flicker with the object generated in flicker_map.json - have you run the Flicker package yet?")}(),rootPath:g.rootPath||"flicker/",container:y,paused:!1,direction:"forward",currentFrame:0,currentSprite:a[0].getAttribute("src"),play:r,reverse:c,pause:t,wait:n,seek:p,utils:o,on:i,eventHandlers:{sequenceChange:function(){return null},flickerEnd:function(){return null}},_advanceRef:null,_delay:0};return _.setAttribute("max",j.animation.frames.length-1),_.addEventListener("input",o.throttle(p)),j};
