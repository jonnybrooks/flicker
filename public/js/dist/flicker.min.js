"use strict";var Flicker=function(){function e(n,r){return v.paused||r!==v._advanceRef?v:("forwards"===v.direction?n>=v.animation.frames.length?(v.paused=!0,v.eventHandlers.flickerEnd.call(v,v.direction)):(t(n),n++):"reverse"===v.direction&&(0>n?(v.paused=!0,v.eventHandlers.flickerEnd.call(v,v.direction)):(t(n),n--)),setTimeout(requestAnimationFrame.bind(null,e.bind(null,n,r)),1e3/24),v)}function t(e){var t=""+v.rootPath+v.animation.frames[e].src,n=document.querySelector('.sprites img[src="'+t+'"]');v.currentSprite!==t&&v.eventHandlers.sequenceChange.call(v,t),v.currentSprite=t,v.currentFrame=e;try{h.drawImage(n,v.animation.frames[e].x,v.animation.frames[e].y,f.w,f.h,0,0,f.w,f.h)}catch(r){throw new c("CanvasDrawError","Failed to draw image at path '"+t+'\'\r\n. Try adding this within your flicker context:\r\n\r\n<img class="sprite" src="'+t+'" alt=" "/>')}}function n(){var t=arguments.length<=0||void 0===arguments[0]?v.currentFrame:arguments[0],n=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],r=new Date;return v._advanceRef=r,v.paused=!1,v.direction=n?"forwards":"reverse",e(t,r),v}function r(e){return n(e,!1)}function i(){return v.paused=!0,v}function a(e){return v._delay+=e,{play:function(){return setTimeout(n,1e3*v._delay),v},reverse:function(){return setTimeout(r,1e3*v._delay),v},pause:function(){return setTimeout(i,1e3*v._delay),v},wait:function(){return setTimeout(a,1e3*v._delay),v}}}function o(){return v.paused=!0,t(this.getAttribute("value")),v}function u(e,t){if(e in v.eventHandlers)return v.eventHandlers[e]=t;throw new c("EventHandlerRegistrationError","The specified event '"+e+"' does not exist")}function c(e,t){var n=new Error(t);return n.name=e,n}var s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],l=function(){if(s.container)return s.container;throw new c("UnspecifiedFlickerContextError","You must specify a container for the Flicker context")}(),d=function(){var e=Array.prototype.slice.call(l.querySelectorAll(".sprite"));if(e.length>0)return e;throw new c("EmptySpriteFlickerError","Each Flicker context must contain at least one sprite")}(),m=l.querySelector("canvas"),f={w:m.getAttribute("width"),h:m.getAttribute("height")},h=m.getContext("2d"),p=l.querySelector(".controls input"),g={waitOnImages:function(e){var t=[];t.push=function(){Array.prototype.push.apply(this,arguments),this.length>=d.length&&e.call(v)};for(var n=0;n<d.length;n++)d[n].onload=function r(e){d[e].complete?t.push(d[e]):setTimeout(r.bind(null,e),10)}(n)},throttle:function(e,t,n){t||(t=100);var r,i;return function(){var a=n||this,o=+new Date,u=arguments;r&&r+t>o?(clearTimeout(i),i=setTimeout(function(){r=o,e.apply(a,u)},t)):(r=o,e.apply(a,u))}}},v={animation:function(){if(s.animation)return s.animation;throw new c("AnimationInitialisationError","You must initialise the Flicker with the object generated in flicker_map.json - have you run the Flicker package yet?")}(),rootPath:s.rootPath||"flicker/",container:l,paused:!1,direction:"forwards",currentFrame:0,currentSprite:d[0].getAttribute("src"),play:n,reverse:r,pause:i,wait:a,seek:o,utils:g,on:u,eventHandlers:{sequenceChange:function(){return null},flickerEnd:function(){return null}},_advanceRef:null,_delay:0};return p.setAttribute("max",v.animation.frames.length-1),p.addEventListener("input",g.throttle(o)),v};
