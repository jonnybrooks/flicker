"use strict";var Flicker=function(){function e(r,c){return a.paused||c!==a._advanceRef?a:("forward"===a.direction?r>=a.animation.frames.length?(a.paused=!0,console.log("animation completed forward")):(s(r),r++):"reverse"===a.direction&&(0>r?(a.paused=!0,console.log("animation completed reverse")):(s(r),r--)),setTimeout(requestAnimationFrame.bind(null,e.bind(null,r,c)),1e3/24),a)}function s(e){var s=""+a.rootPath+a.animation.frames[e].src,r=document.querySelector('.sprites img[src="'+s+'"]');a.currentSprite!==s&&null!==a.eventHandlers.sequenceChange&&a.eventHandlers.sequenceChange.call(a,s),a.currentSprite=s,a.currentFrame=e;try{q.drawImage(r,-1*a.animation.frames[e].x,-1*a.animation.frames[e].y)}catch(c){throw new Error("Failed to draw image at path '"+s+'\'\r\nThis error usually occurs when the animation tries to draw a sprite which is not within this flicker context; try adding this within your flicker context:\r\n\r\n<img class="sprite" src="'+s+'" alt=" "/>')}}function r(s){var r=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],c=new Date,t=s||a.currentFrame;return a._advanceRef=c,a.paused=!1,a.direction=r?"forward":"reverse",e(t,c),a}function c(e){return r(e,!1)}function t(){return a.paused=!0,a}function p(e){return a._delay+=e,{play:function(){return setTimeout(r,1e3*a._delay),a},reverse:function(){return setTimeout(c,1e3*a._delay),a},pause:function(){return setTimeout(t,1e3*a._delay),a},wait:function(){return setTimeout(p,1e3*a._delay),a}}}function n(){return t(),s(this.getAttribute("value")),a}function i(e,s){if(e in a.eventHandlers)return a.eventHandlers[e]=s;throw new Error("Event handler registration failed: the specified event '"+e+"' does not exist")}var u=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],g=function(){if(u.container)return u.container;throw new Error("You must specify a container for the Flicker context")}(),y=function(){var e=Array.prototype.slice.call(g.querySelectorAll(".sprite"));if(e.length>0)return e;throw new Error("Each Flicker context must contain at least one sprite")}(),x=g.querySelector("canvas"),q=x.getContext("2d"),_=g.querySelector(".controls input"),j={waitOnImages:function(e){var s=[];s.push=function(){Array.prototype.push.apply(this,arguments),this.length>=y.length&&e.call(a)};for(var r=0;r<y.length;r++)y[r].onload=function c(e){y[e].complete?s.push(y[e]):setTimeout(c.bind(null,e),10)}(r)},throttle:function(e,s,r){s||(s=100);var c,t;return function(){var p=r||this,n=+new Date,i=arguments;c&&c+s>n?(clearTimeout(t),t=setTimeout(function(){c=n,e.apply(p,i)},s)):(c=n,e.apply(p,i))}}},a={animation:function(){if(u.animation)return u.animation;throw new Error("Animation can't be undefined")}(),rootPath:u.rootPath||"flicker/",container:g,paused:!1,direction:"forward",currentFrame:0,currentSprite:y[0].getAttribute("src"),play:r,reverse:c,pause:t,wait:p,seek:n,utils:j,on:i,eventHandlers:{sequenceChange:null},_advanceRef:null,_delay:0};return _.setAttribute("max",a.animation.frames.length-1),_.addEventListener("input",j.throttle(n)),a};
